<mxfile host="app.diagrams.net" modified="2022-07-05T13:34:06.248Z" agent="5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.87 Safari/537.36 SE 2.X MetaSr 1.0" etag="0xRPqokP9lnnyKBtkHtt" version="20.0.4" type="github">
  <diagram id="SV0dx7TeNnwzuteji7VQ" name="Page-1">
    <mxGraphModel dx="2998" dy="2035" grid="0" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="0" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-63" value="" style="rounded=0;whiteSpace=wrap;html=1;dashed=1;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="-536" y="131" width="1459" height="1255" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-37" value="" style="rounded=0;whiteSpace=wrap;html=1;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="940" y="-656" width="473" height="725" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-1" value="" style="rounded=0;whiteSpace=wrap;html=1;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="-502" y="-593" width="1131" height="635" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-2" value="&lt;font style=&quot;font-size: 13px;&quot;&gt;while(1)死循环&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="1" y="-631" width="105" height="30" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-9" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=14;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="zQ2Y9jjjKYXvb-ktNzpl-4" target="zQ2Y9jjjKYXvb-ktNzpl-8">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="136" y="-306" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-14" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=14;" edge="1" parent="1" source="zQ2Y9jjjKYXvb-ktNzpl-4" target="zQ2Y9jjjKYXvb-ktNzpl-13">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="136" y="-384" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-17" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=14;" edge="1" parent="1" source="zQ2Y9jjjKYXvb-ktNzpl-4" target="zQ2Y9jjjKYXvb-ktNzpl-12">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-4" value="ret&amp;nbsp; = LoginQuery_Get(login)&lt;br&gt;//获取一条上下线记录" style="rounded=0;whiteSpace=wrap;html=1;fontSize=13;" vertex="1" parent="1">
          <mxGeometry x="38" y="-487" width="196" height="44" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=13;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="1" source="zQ2Y9jjjKYXvb-ktNzpl-47" target="zQ2Y9jjjKYXvb-ktNzpl-4">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="136" y="-527" as="sourcePoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-23" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=14;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="1" source="zQ2Y9jjjKYXvb-ktNzpl-8" target="zQ2Y9jjjKYXvb-ktNzpl-19">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-11" value="0-succ" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=14;" vertex="1" parent="1">
          <mxGeometry x="148" y="-351" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-12" value="Error处理，“上线uin获取失败”" style="rounded=0;whiteSpace=wrap;html=1;fontSize=14;" vertex="1" parent="1">
          <mxGeometry x="472" y="-495" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-22" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=14;exitX=0.5;exitY=1;exitDx=0;exitDy=0;startArrow=none;" edge="1" parent="1" source="zQ2Y9jjjKYXvb-ktNzpl-8" target="zQ2Y9jjjKYXvb-ktNzpl-19">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-27" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;fontSize=14;" edge="1" parent="1" source="zQ2Y9jjjKYXvb-ktNzpl-13" target="zQ2Y9jjjKYXvb-ktNzpl-19">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="536" y="-44" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-13" value="unsleep(20)" style="rounded=0;whiteSpace=wrap;html=1;fontSize=14;" vertex="1" parent="1">
          <mxGeometry x="471" y="-417" width="122" height="66" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-15" value="1-empty" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=14;" vertex="1" parent="1">
          <mxGeometry x="312" y="-420" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-18" value="else-error" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=14;" vertex="1" parent="1">
          <mxGeometry x="320" y="-499" width="66" height="30" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-19" value="CheckRecv(stSelectVar);&lt;br&gt;//确认机器状态，心跳功能" style="rounded=0;whiteSpace=wrap;html=1;fontSize=14;" vertex="1" parent="1">
          <mxGeometry x="50.5" y="-74" width="172" height="60" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-31" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=14;" edge="1" parent="1" source="zQ2Y9jjjKYXvb-ktNzpl-8" target="zQ2Y9jjjKYXvb-ktNzpl-29">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-8" value="QueryUinRoomInfo(login)&lt;br&gt;//查询该用户是否有room" style="rounded=0;whiteSpace=wrap;html=1;fontSize=14;" vertex="1" parent="1">
          <mxGeometry x="50" y="-302" width="172" height="60" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-29" value="&lt;div&gt;&lt;b&gt;Notify&lt;/b&gt;(pstUinIndexNode, uin, app_id, instanceId, sso_ip, sso_port, client_id, client_ip, client_port,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;on_line_client_type);&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=14;" vertex="1" parent="1">
          <mxGeometry x="-476" y="-302" width="315" height="60" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-32" value="机型，上线状态等进行判断" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=14;" vertex="1" parent="1">
          <mxGeometry x="-142.5" y="-264" width="173" height="30" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-33" value="pstUinIndexNode = g_uin_index_hash_table.get(uin);&lt;br&gt;//根据uin去生成新的hash，作为id" style="text;whiteSpace=wrap;html=1;fontSize=14;align=center;" vertex="1" parent="1">
          <mxGeometry x="-238" y="-346" width="364" height="39" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-48" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=19;fontColor=#000000;" edge="1" parent="1" source="zQ2Y9jjjKYXvb-ktNzpl-35" target="zQ2Y9jjjKYXvb-ktNzpl-38">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-35" value="&amp;nbsp;pstRoomIndexNode = g_room_index_hash_table.get(pstUinIndexNode-&amp;gt;uin_roomid_arry[idx].room_id);&lt;span style=&quot;white-space: pre;&quot;&gt;	&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;	&lt;/span&gt;//根据对应的uin找到room_id" style="rounded=0;whiteSpace=wrap;html=1;fontSize=14;" vertex="1" parent="1">
          <mxGeometry x="993.5" y="-610" width="344" height="75" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-49" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=19;fontColor=#000000;" edge="1" parent="1" source="zQ2Y9jjjKYXvb-ktNzpl-38" target="zQ2Y9jjjKYXvb-ktNzpl-40">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-38" value="S2CSendMsgToInstance(uin, uin, app_id, toInstanceId, head, msgBody)" style="rounded=0;whiteSpace=wrap;html=1;fontSize=14;" vertex="1" parent="1">
          <mxGeometry x="1025" y="-467" width="281" height="60" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-50" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=19;fontColor=#000000;" edge="1" parent="1" source="zQ2Y9jjjKYXvb-ktNzpl-40" target="zQ2Y9jjjKYXvb-ktNzpl-42">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-40" value="S2CSendData(data, dataLen, g_stConfig.iSendS2Cfd);&lt;span style=&quot;&quot;&gt;	&lt;br&gt;&lt;/span&gt;//INFO(&quot;send s2c has room info, uin[%llu] appid[%hu]&quot;, toUin, toAppId)" style="rounded=0;whiteSpace=wrap;html=1;fontSize=14;" vertex="1" parent="1">
          <mxGeometry x="1025" y="-345" width="281" height="79" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-51" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=19;fontColor=#000000;" edge="1" parent="1" source="zQ2Y9jjjKYXvb-ktNzpl-42" target="zQ2Y9jjjKYXvb-ktNzpl-44">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-42" value="ret = CMLB_V2_GetOneIntf(&amp;amp;g_cmlbClientApi, CMLB_APPID_MSGAGENT, &amp;amp;mfpd_address, sizeof(mfpd_address))&lt;br&gt;//找mfpd的地址" style="rounded=0;whiteSpace=wrap;html=1;fontSize=14;" vertex="1" parent="1">
          <mxGeometry x="965.5" y="-190" width="400.5" height="77" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-44" value="ret = sendto(fd, data, len, 0, (struct sockaddr *)&amp;amp;mfpd_address, sizeof(struct sockaddr_in));&lt;br&gt;//return表示向msgAgent发送S2C消息成功与否（大于0表示succ）" style="rounded=0;whiteSpace=wrap;html=1;fontSize=14;" vertex="1" parent="1">
          <mxGeometry x="965.5" y="-37" width="399.5" height="77" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-45" value="&lt;font style=&quot;font-size: 19px;&quot;&gt;Notify函数&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=14;" vertex="1" parent="1">
          <mxGeometry x="1101" y="-690" width="135" height="30" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-47" value="LoginRecord login" style="text;html=1;strokeColor=default;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;labelBackgroundColor=none;fontSize=19;fontColor=#000000;" vertex="1" parent="1">
          <mxGeometry x="24" y="-563" width="222" height="30" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-54" value="MultiPushMsg::doServiceLogic()" style="rounded=0;whiteSpace=wrap;html=1;labelBackgroundColor=none;fontSize=19;fontColor=#000000;strokeColor=none;" vertex="1" parent="1">
          <mxGeometry x="13" y="95" width="337" height="40" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-65" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=19;fontColor=#99004D;" edge="1" parent="1" source="zQ2Y9jjjKYXvb-ktNzpl-55" target="zQ2Y9jjjKYXvb-ktNzpl-56">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-66" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=19;fontColor=#99004D;" edge="1" parent="1" source="zQ2Y9jjjKYXvb-ktNzpl-55" target="zQ2Y9jjjKYXvb-ktNzpl-58">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-67" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=19;fontColor=#99004D;" edge="1" parent="1" source="zQ2Y9jjjKYXvb-ktNzpl-55" target="zQ2Y9jjjKYXvb-ktNzpl-59">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-55" value="getAddrRes = CONF::Instance()-&amp;gt;getOidbAddr(&amp;amp;oidbAddr);&lt;br&gt;//通过conf里面的getOidbAddr,返回CMLB_V2_GetOneIntf对应的OIDB服务实例" style="rounded=0;whiteSpace=wrap;html=1;labelBackgroundColor=none;fontSize=19;fontColor=#000000;strokeColor=default;" vertex="1" parent="1">
          <mxGeometry x="-241" y="215" width="672" height="68" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-79" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=22;fontColor=#000000;" edge="1" parent="1" source="zQ2Y9jjjKYXvb-ktNzpl-56" target="zQ2Y9jjjKYXvb-ktNzpl-76">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-56" value="PackageBuilder::getInstance()-&amp;gt;encodeReqOIDB0x860(sendBuf, sizeof(sendBuf), sendPkgLen, pushUin)&lt;span style=&quot;&quot;&gt;	&lt;/span&gt;//0x860(通过OIDB拉取加入的讨论组列表)" style="rounded=0;whiteSpace=wrap;html=1;labelBackgroundColor=none;fontSize=19;fontColor=#000000;strokeColor=default;fillColor=#D9D9D9;" vertex="1" parent="1">
          <mxGeometry x="-487" y="352" width="361" height="118" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-80" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=22;fontColor=#000000;" edge="1" parent="1" source="zQ2Y9jjjKYXvb-ktNzpl-58" target="zQ2Y9jjjKYXvb-ktNzpl-76">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-58" value="PackageBuilder::getInstance()-&amp;gt;encodeReqOIDB0x5d5(sendBuf, sizeof(sendBuf), sendPkgLen, pushUin)&lt;br&gt;//0x5d5(通过OIDB拉取加入的群列表)" style="rounded=0;whiteSpace=wrap;html=1;labelBackgroundColor=none;fontSize=19;fontColor=#000000;strokeColor=default;fillColor=#D9D9D9;" vertex="1" parent="1">
          <mxGeometry x="-95" y="352" width="379" height="118" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-81" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=22;fontColor=#000000;" edge="1" parent="1" source="zQ2Y9jjjKYXvb-ktNzpl-59" target="zQ2Y9jjjKYXvb-ktNzpl-76">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-59" value="&lt;div&gt;// 0x724(通过OIDB拉取加入的多人会话列表)&lt;/div&gt;&lt;div&gt;// 0xa97(通过OIDB拉取加入的组织列表)&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;labelBackgroundColor=none;fontSize=19;fontColor=#000000;strokeColor=default;align=left;fillColor=#FFDCB5;" vertex="1" parent="1">
          <mxGeometry x="306" y="352" width="202" height="118" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-82" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=22;fontColor=#000000;" edge="1" parent="1" source="zQ2Y9jjjKYXvb-ktNzpl-60" target="zQ2Y9jjjKYXvb-ktNzpl-76">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-60" value="&lt;div style=&quot;text-align: center;&quot;&gt;// 0x911(通过QCallOIDB拉取讨论组列表)&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;labelBackgroundColor=none;fontSize=19;fontColor=#000000;strokeColor=default;align=left;fillColor=#EB8DE1;" vertex="1" parent="1">
          <mxGeometry x="580.25" y="352" width="212.5" height="118" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-71" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=19;fontColor=#000000;" edge="1" parent="1" source="zQ2Y9jjjKYXvb-ktNzpl-62" target="zQ2Y9jjjKYXvb-ktNzpl-60">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-62" value="&lt;div style=&quot;text-align: center;&quot;&gt;getAddrRes = CONF::Instance()-&amp;gt;getQCallOidbAddr(&amp;amp;oidbAddr);&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;labelBackgroundColor=none;fontSize=19;fontColor=#000000;strokeColor=default;align=left;" vertex="1" parent="1">
          <mxGeometry x="528" y="190" width="317" height="118" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-64" value="&lt;div style=&quot;font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: center; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial; font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; line-height: 27px;&quot;&gt;&lt;div style=&quot;&quot;&gt;&lt;font style=&quot;&quot; color=&quot;#99004d&quot;&gt;&lt;span style=&quot;font-size: 20px;&quot;&gt;================ &lt;/span&gt;&lt;font style=&quot;font-size: 30px;&quot;&gt;①&lt;/font&gt;&lt;span style=&quot;font-size: 20px;&quot;&gt;通过oidb获取群或讨论组列表 ================&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;" style="text;whiteSpace=wrap;html=1;fontSize=19;fontColor=#000000;" vertex="1" parent="1">
          <mxGeometry x="-137" y="154" width="703" height="42" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-68" value="&lt;font color=&quot;#000000&quot;&gt;手Q||PCQQ&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;labelBackgroundColor=none;fontSize=19;fontColor=#99004D;" vertex="1" parent="1">
          <mxGeometry x="-298" y="288" width="172" height="30" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-69" value="&lt;font color=&quot;#000000&quot;&gt;手Q||PCQQ&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;labelBackgroundColor=none;fontSize=19;fontColor=#99004D;" vertex="1" parent="1">
          <mxGeometry x="27" y="313" width="172" height="30" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-70" value="&lt;font color=&quot;#000000&quot;&gt;企业QQ(EIM)&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;labelBackgroundColor=none;fontSize=19;fontColor=#99004D;" vertex="1" parent="1">
          <mxGeometry x="306" y="283" width="172" height="30" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-72" value="&lt;font color=&quot;#000000&quot;&gt;QCall&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;labelBackgroundColor=none;fontSize=19;fontColor=#99004D;" vertex="1" parent="1">
          <mxGeometry x="668" y="313" width="172" height="30" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-75" value="&lt;div style=&quot;orphans: 2; text-align: center; text-indent: 0px; widows: 2; text-decoration-style: initial; text-decoration-color: initial; line-height: 27px;&quot;&gt;&lt;div style=&quot;&quot;&gt;&lt;font style=&quot;&quot; color=&quot;#99004d&quot;&gt;&lt;span style=&quot;font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; text-transform: none; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 20px;&quot;&gt;================ &lt;/span&gt;&lt;span style=&quot;font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; text-transform: none; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 30px;&quot;&gt;②&lt;/span&gt;&lt;/font&gt;&lt;span style=&quot;color: rgb(153, 0, 77); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 20px; background-color: initial;&quot;&gt;通过roomInfoVec在redis中&lt;/span&gt;&lt;span style=&quot;font-size: 20px; font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; color: rgb(153, 0, 77); background-color: initial;&quot;&gt;查询群或讨论组是否有视频&lt;/span&gt;&lt;span style=&quot;font-size: 20px; font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; color: rgb(153, 0, 77); background-color: initial;&quot;&gt;&amp;nbsp;================&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="text;whiteSpace=wrap;html=1;fontSize=19;fontColor=#000000;" vertex="1" parent="1">
          <mxGeometry x="-289" y="543" width="934" height="42" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-85" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=22;fontColor=#000000;" edge="1" parent="1" source="zQ2Y9jjjKYXvb-ktNzpl-76" target="zQ2Y9jjjKYXvb-ktNzpl-77">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-76" value="&lt;span style=&quot;font-size: 22px;&quot;&gt;for (vector&amp;lt;roomInfo&amp;gt;::iterator it = roomInfoVec.begin(); it != roomInfoVec.end();)&lt;br&gt;//遍历roomInfoVec检查是否有视频//&lt;/span&gt;" style="rounded=0;whiteSpace=wrap;html=1;labelBackgroundColor=none;fontSize=19;fontColor=#000000;strokeColor=default;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="-436.5" y="585" width="1207" height="75" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-86" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=22;fontColor=#000000;" edge="1" parent="1" source="zQ2Y9jjjKYXvb-ktNzpl-77" target="zQ2Y9jjjKYXvb-ktNzpl-84">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-77" value="&lt;div&gt;&lt;span style=&quot;font-size: 22px;&quot;&gt;&lt;b&gt;PackageBuilder::getInstance()-&amp;gt;encodeReq0x90(&lt;/b&gt;sendBuf,&lt;/span&gt;&lt;span style=&quot;font-size: 22px; background-color: initial;&quot;&gt;sizeof(sendBuf),&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial; font-size: 22px;&quot;&gt;sendPkgLen,&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial; font-size: 22px;&quot;&gt;pushUin,&lt;/span&gt;&lt;span style=&quot;background-color: initial; font-size: 22px;&quot;&gt;rand(),&lt;/span&gt;&lt;span style=&quot;background-color: initial; font-size: 22px;&quot;&gt;0x90,&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial; font-size: 22px;&quot;&gt;dispatchInfo.room_info().room_id(),&lt;/span&gt;&lt;span style=&quot;background-color: initial; font-size: 22px;&quot;&gt;redisKey.relation_id,&lt;/span&gt;&lt;span style=&quot;background-color: initial; font-size: 22px;&quot;&gt;0,&lt;/span&gt;&lt;span style=&quot;background-color: initial; font-size: 22px;&quot;&gt;dispatchInfo.room_info().last_update_time().sec(),&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial; font-size: 22px;&quot;&gt;redisKey.relation_id,&lt;/span&gt;&lt;span style=&quot;background-color: initial; font-size: 22px;&quot;&gt;redisKey.relation_type,&lt;/span&gt;&lt;span style=&quot;background-color: initial; font-size: 22px;&quot;&gt;redisKey.business_type,&lt;/span&gt;&lt;span style=&quot;background-color: initial; font-size: 22px;&quot;&gt;2,&lt;/span&gt;&lt;span style=&quot;background-color: initial; font-size: 22px;&quot;&gt;2, logstr)&lt;span style=&quot;white-space: pre;&quot;&gt;	&lt;/span&gt;//先访问流控服务&lt;/span&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;labelBackgroundColor=none;fontSize=19;fontColor=#000000;strokeColor=default;fillColor=none;direction=south;" vertex="1" parent="1">
          <mxGeometry x="-377.5" y="725" width="1089" height="127" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-83" value="&lt;div style=&quot;orphans: 2; text-align: center; text-indent: 0px; widows: 2; text-decoration-style: initial; text-decoration-color: initial; line-height: 27px;&quot;&gt;&lt;div style=&quot;&quot;&gt;&lt;font style=&quot;&quot; color=&quot;#99004d&quot;&gt;&lt;span style=&quot;font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; text-transform: none; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 20px;&quot;&gt;================ &lt;/span&gt;&lt;span style=&quot;font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; text-transform: none; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 30px;&quot;&gt;③&lt;/span&gt;&lt;/font&gt;&lt;span style=&quot;color: rgb(153, 0, 77); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 20px; background-color: initial;&quot;&gt;通过对有视频的rediskey查询流控信息&lt;/span&gt;&lt;span style=&quot;font-size: 20px; font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; color: rgb(153, 0, 77); background-color: initial;&quot;&gt;================&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="text;whiteSpace=wrap;html=1;fontSize=19;fontColor=#000000;" vertex="1" parent="1">
          <mxGeometry x="-241" y="675" width="934" height="42" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-84" value="&lt;div&gt;&lt;span style=&quot;font-size: 22px;&quot;&gt;sendRecvRes = mt_udpsendrcv(&lt;/span&gt;&lt;span style=&quot;font-size: 22px; background-color: initial;&quot;&gt;&amp;amp;centAddr, (void *)sendBuf, sendPkgLen, recvBuf, recvPkgLen,&amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 22px;&quot;&gt;CONF::Instance()-&amp;gt;centTimeOut);&lt;span style=&quot;white-space: pre;&quot;&gt;	&lt;/span&gt;//根据流控ip（redis中包含流控ip，接口机实例，还有建房信息等）找到对应的数据信息&lt;/span&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;labelBackgroundColor=none;fontSize=19;fontColor=#000000;strokeColor=default;fillColor=none;direction=south;" vertex="1" parent="1">
          <mxGeometry x="-423.5" y="893" width="1181" height="108" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-87" value="&lt;div style=&quot;orphans: 2; text-align: center; text-indent: 0px; widows: 2; text-decoration-style: initial; text-decoration-color: initial; line-height: 27px;&quot;&gt;&lt;div style=&quot;&quot;&gt;&lt;font style=&quot;&quot; color=&quot;#99004d&quot;&gt;&lt;span style=&quot;font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; text-transform: none; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 20px;&quot;&gt;================ &lt;/span&gt;&lt;span style=&quot;font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; text-transform: none; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 30px;&quot;&gt;④&lt;/span&gt;&lt;/font&gt;&lt;span style=&quot;color: rgb(153, 0, 77); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-size: 20px; background-color: initial;&quot;&gt;把查询到的房间信息下发用户(下发S2C消息)&lt;/span&gt;&lt;span style=&quot;font-size: 20px; font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; color: rgb(153, 0, 77); background-color: initial;&quot;&gt;================&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="text;whiteSpace=wrap;html=1;fontSize=19;fontColor=#000000;" vertex="1" parent="1">
          <mxGeometry x="-257" y="1037" width="934" height="42" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-88" value="&lt;div&gt;&lt;span style=&quot;font-size: 22px;&quot;&gt;PackageBuilder::getInstance()-&amp;gt;encode0x95Req(&lt;/span&gt;&lt;span style=&quot;font-size: 22px; background-color: initial;&quot;&gt;sendBuf, sizeof(sendBuf), sendPkgLen, pushUin, roomInfoVec, isPc, msgSeq)PackageBuilder::getInstance()-&amp;gt;encode0x95Req(&lt;/span&gt;&lt;span style=&quot;font-size: 22px; background-color: initial;&quot;&gt;sendBuf, sizeof(sendBuf), sendPkgLen, pushUin, roomInfoVec, isPc, msgSeq)&lt;/span&gt;&lt;span style=&quot;font-size: 22px; background-color: initial; white-space: pre;&quot;&gt;	&lt;/span&gt;&lt;span style=&quot;font-size: 22px; background-color: initial;&quot;&gt;//组包&lt;span style=&quot;white-space: pre;&quot;&gt;	&lt;/span&gt;//后续会检查组包长度，超长也是组包失败，不做别的处理&lt;/span&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;labelBackgroundColor=none;fontSize=19;fontColor=#000000;strokeColor=default;fillColor=none;direction=south;" vertex="1" parent="1">
          <mxGeometry x="-290" y="1081" width="943" height="108" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-89" value="&lt;div&gt;&lt;span style=&quot;font-size: 22px;&quot;&gt;sendRecvRes = mt_udpsendrcv(&lt;/span&gt;&lt;span style=&quot;font-size: 22px; background-color: initial;&quot;&gt;&amp;amp;msgAgentAddr, (void *)sendBuf, sendPkgLen, recvBuf, recvPkgLen, CONF::Instance()-&amp;gt;msgAgentTimeOut);&lt;/span&gt;&lt;span style=&quot;font-size: 22px; background-color: initial; white-space: pre;&quot;&gt;	&lt;/span&gt;&lt;span style=&quot;font-size: 22px; background-color: initial;&quot;&gt;//组包发送给msgAgent&lt;/span&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;labelBackgroundColor=none;fontSize=19;fontColor=#000000;strokeColor=default;fillColor=none;direction=south;" vertex="1" parent="1">
          <mxGeometry x="-289" y="1234" width="943" height="108" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
