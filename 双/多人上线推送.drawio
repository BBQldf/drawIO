<mxfile host="app.diagrams.net" modified="2022-07-05T12:04:43.036Z" agent="5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.87 Safari/537.36 SE 2.X MetaSr 1.0" etag="NhTYOYu_02quunJte89-" version="20.0.4" type="github">
  <diagram id="SV0dx7TeNnwzuteji7VQ" name="Page-1">
    <mxGraphModel dx="2222" dy="1599" grid="0" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="0" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-37" value="" style="rounded=0;whiteSpace=wrap;html=1;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="940" y="-656" width="473" height="725" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-1" value="" style="rounded=0;whiteSpace=wrap;html=1;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="-502" y="-593" width="1131" height="635" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-2" value="&lt;font style=&quot;font-size: 13px;&quot;&gt;while(1)死循环&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="1" y="-631" width="105" height="30" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-9" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=14;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="zQ2Y9jjjKYXvb-ktNzpl-4" target="zQ2Y9jjjKYXvb-ktNzpl-8">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="136" y="-306" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-14" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=14;" edge="1" parent="1" source="zQ2Y9jjjKYXvb-ktNzpl-4" target="zQ2Y9jjjKYXvb-ktNzpl-13">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="136" y="-384" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-17" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=14;" edge="1" parent="1" source="zQ2Y9jjjKYXvb-ktNzpl-4" target="zQ2Y9jjjKYXvb-ktNzpl-12">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-4" value="ret&amp;nbsp; = LoginQuery_Get(login)&lt;br&gt;//获取一条上下线记录" style="rounded=0;whiteSpace=wrap;html=1;fontSize=13;" vertex="1" parent="1">
          <mxGeometry x="38" y="-487" width="196" height="44" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=13;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="1" source="zQ2Y9jjjKYXvb-ktNzpl-47" target="zQ2Y9jjjKYXvb-ktNzpl-4">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="136" y="-527" as="sourcePoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-23" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=14;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="1" source="zQ2Y9jjjKYXvb-ktNzpl-8" target="zQ2Y9jjjKYXvb-ktNzpl-19">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-11" value="0-succ" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=14;" vertex="1" parent="1">
          <mxGeometry x="148" y="-351" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-12" value="Error处理，“上线uin获取失败”" style="rounded=0;whiteSpace=wrap;html=1;fontSize=14;" vertex="1" parent="1">
          <mxGeometry x="472" y="-495" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-22" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=14;exitX=0.5;exitY=1;exitDx=0;exitDy=0;startArrow=none;" edge="1" parent="1" source="zQ2Y9jjjKYXvb-ktNzpl-8" target="zQ2Y9jjjKYXvb-ktNzpl-19">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-27" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;fontSize=14;" edge="1" parent="1" source="zQ2Y9jjjKYXvb-ktNzpl-13" target="zQ2Y9jjjKYXvb-ktNzpl-19">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="536" y="-44" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-13" value="unsleep(20)" style="rounded=0;whiteSpace=wrap;html=1;fontSize=14;" vertex="1" parent="1">
          <mxGeometry x="471" y="-417" width="122" height="66" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-15" value="1-empty" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=14;" vertex="1" parent="1">
          <mxGeometry x="312" y="-420" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-18" value="else-error" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=14;" vertex="1" parent="1">
          <mxGeometry x="320" y="-499" width="66" height="30" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-19" value="CheckRecv(stSelectVar);&lt;br&gt;//确认机器状态，心跳功能" style="rounded=0;whiteSpace=wrap;html=1;fontSize=14;" vertex="1" parent="1">
          <mxGeometry x="50.5" y="-74" width="172" height="60" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-31" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=14;" edge="1" parent="1" source="zQ2Y9jjjKYXvb-ktNzpl-8" target="zQ2Y9jjjKYXvb-ktNzpl-29">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-8" value="QueryUinRoomInfo(login)&lt;br&gt;//查询该用户是否有room" style="rounded=0;whiteSpace=wrap;html=1;fontSize=14;" vertex="1" parent="1">
          <mxGeometry x="50" y="-302" width="172" height="60" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-29" value="&lt;div&gt;&lt;b&gt;Notify&lt;/b&gt;(pstUinIndexNode, uin, app_id, instanceId, sso_ip, sso_port, client_id, client_ip, client_port,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;on_line_client_type);&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontSize=14;" vertex="1" parent="1">
          <mxGeometry x="-476" y="-302" width="315" height="60" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-32" value="机型，上线状态等进行判断" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=14;" vertex="1" parent="1">
          <mxGeometry x="-142.5" y="-264" width="173" height="30" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-33" value="pstUinIndexNode = g_uin_index_hash_table.get(uin);&lt;br&gt;//根据uin去生成新的hash，作为id" style="text;whiteSpace=wrap;html=1;fontSize=14;align=center;" vertex="1" parent="1">
          <mxGeometry x="-238" y="-346" width="364" height="39" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-48" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=19;fontColor=#000000;" edge="1" parent="1" source="zQ2Y9jjjKYXvb-ktNzpl-35" target="zQ2Y9jjjKYXvb-ktNzpl-38">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-35" value="&amp;nbsp;pstRoomIndexNode = g_room_index_hash_table.get(pstUinIndexNode-&amp;gt;uin_roomid_arry[idx].room_id);&lt;span style=&quot;white-space: pre;&quot;&gt;	&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;	&lt;/span&gt;//根据对应的uin找到room_id" style="rounded=0;whiteSpace=wrap;html=1;fontSize=14;" vertex="1" parent="1">
          <mxGeometry x="993.5" y="-610" width="344" height="75" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-49" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=19;fontColor=#000000;" edge="1" parent="1" source="zQ2Y9jjjKYXvb-ktNzpl-38" target="zQ2Y9jjjKYXvb-ktNzpl-40">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-38" value="S2CSendMsgToInstance(uin, uin, app_id, toInstanceId, head, msgBody)" style="rounded=0;whiteSpace=wrap;html=1;fontSize=14;" vertex="1" parent="1">
          <mxGeometry x="1025" y="-467" width="281" height="60" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-50" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=19;fontColor=#000000;" edge="1" parent="1" source="zQ2Y9jjjKYXvb-ktNzpl-40" target="zQ2Y9jjjKYXvb-ktNzpl-42">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-40" value="S2CSendData(data, dataLen, g_stConfig.iSendS2Cfd);&lt;span style=&quot;&quot;&gt;	&lt;br&gt;&lt;/span&gt;//INFO(&quot;send s2c has room info, uin[%llu] appid[%hu]&quot;, toUin, toAppId)" style="rounded=0;whiteSpace=wrap;html=1;fontSize=14;" vertex="1" parent="1">
          <mxGeometry x="1025" y="-345" width="281" height="79" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-51" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=19;fontColor=#000000;" edge="1" parent="1" source="zQ2Y9jjjKYXvb-ktNzpl-42" target="zQ2Y9jjjKYXvb-ktNzpl-44">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-42" value="ret = CMLB_V2_GetOneIntf(&amp;amp;g_cmlbClientApi, CMLB_APPID_MSGAGENT, &amp;amp;mfpd_address, sizeof(mfpd_address))&lt;br&gt;//找mfpd的地址" style="rounded=0;whiteSpace=wrap;html=1;fontSize=14;" vertex="1" parent="1">
          <mxGeometry x="965.5" y="-190" width="400.5" height="77" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-44" value="ret = sendto(fd, data, len, 0, (struct sockaddr *)&amp;amp;mfpd_address, sizeof(struct sockaddr_in));&lt;br&gt;//return表示向msgAgent发送S2C消息成功与否（大于0表示succ）" style="rounded=0;whiteSpace=wrap;html=1;fontSize=14;" vertex="1" parent="1">
          <mxGeometry x="965.5" y="-37" width="399.5" height="77" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-45" value="&lt;font style=&quot;font-size: 19px;&quot;&gt;Notify函数&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=14;" vertex="1" parent="1">
          <mxGeometry x="1101" y="-690" width="135" height="30" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-47" value="LoginRecord login" style="text;html=1;strokeColor=default;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;labelBackgroundColor=none;fontSize=19;fontColor=#000000;" vertex="1" parent="1">
          <mxGeometry x="24" y="-563" width="222" height="30" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-52" value="" style="rounded=0;whiteSpace=wrap;html=1;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="-502" y="146" width="1131" height="635" as="geometry" />
        </mxCell>
        <mxCell id="zQ2Y9jjjKYXvb-ktNzpl-54" value="MultiPushMsg::doServiceLogic()" style="rounded=0;whiteSpace=wrap;html=1;labelBackgroundColor=none;fontSize=19;fontColor=#000000;strokeColor=none;" vertex="1" parent="1">
          <mxGeometry x="-148" y="106" width="337" height="40" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
